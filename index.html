<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHIA Community Pixel Art</title>
  <style>
    body { margin: 0; display: flex; flex-direction: column; align-items: center; }
    #toolbar { margin: 10px; }
    canvas {
      /* шахматный фон через два повторяющихся линейных градиента */
      background:
        repeating-linear-gradient(0deg, #ccc 0px, #ccc 20px, transparent 20px, transparent 40px),
        repeating-linear-gradient(90deg, #ccc 0px, #ccc 20px, transparent 20px, transparent 40px);
      background-size: 40px 40px; /* размер ячейки шахматки */ :contentReference[oaicite:6]{index=6}
      image-rendering: pixelated; /* резкость пикселей при зуме */ :contentReference[oaicite:7]{index=7}
      cursor: crosshair;
    }
  </style>
</head>
<body>
  <h1>CHIA Community Pixel Art</h1>
  <div id="toolbar">
    <input type="color" id="colorPicker" value="#000000"> <!-- палитра цветов --> :contentReference[oaicite:8]{index=8}
    <button id="zoomIn">+</button>
    <button id="zoomOut">−</button>
  </div>
  <canvas id="pixelCanvas" width="1000" height="1000"></canvas> <!-- Canvas 1000×1000 --> :contentReference[oaicite:9]{index=9}

  <!-- Socket.IO клиент из CDN -->
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"
          integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+"
          crossorigin="anonymous"></script> :contentReference[oaicite:10]{index=10}

  <script>
    const socket = io('https://your-server-url.com'); // подключение к серверу :contentReference[oaicite:11]{index=11}
    let scale = 1;
    const canvas = document.getElementById('pixelCanvas');
    const ctx = canvas.getContext('2d');

    // Зум: промежуточный Canvas + drawImage + отключенный smoothing :contentReference[oaicite:12]{index=12}
    document.getElementById('zoomIn').onclick = () => { scale *= 1.2; redraw(); };
    document.getElementById('zoomOut').onclick = () => { scale /= 1.2; redraw(); };

    // Инициализация: сервер шлёт полный массив цветов 1000×1000 :contentReference[oaicite:13]{index=13}
    socket.on('init', state =>
      state.forEach((row, y) => row.forEach((color, x) => drawPixel(x, y, color)))
    );
    // При новом пикселе от сервера :contentReference[oaicite:14]{index=14}
    socket.on('draw', ({ x, y, color }) => drawPixel(x, y, color));

    // Отправка клика: координаты через getBoundingClientRect и деление на scale :contentReference[oaicite:15]{index=15}
    canvas.addEventListener('click', e => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / scale);
      const y = Math.floor((e.clientY - rect.top) / scale);
      const color = document.getElementById('colorPicker').value;
      socket.emit('draw', { x, y, color });
    });

    // Рисуем отдельный пиксель 1×1 px методом fillRect :contentReference[oaicite:16]{index=16}
    function drawPixel(x, y, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x, y, 1, 1);
    }

    // Функция redraw для зума
    function redraw() {
      const tmp = document.createElement('canvas');
      tmp.width = tmp.height = 1000;
      tmp.getContext('2d').drawImage(canvas, 0, 0);
      canvas.width = 1000 * scale;
      canvas.height = 1000 * scale;
      ctx.imageSmoothingEnabled = false;
      ctx.drawImage(tmp, 0, 0, canvas.width, canvas.height);
    }
  </script>
</body>
</html>
